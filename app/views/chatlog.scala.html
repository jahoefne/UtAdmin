<!-- Angular based UtAdmin Chat Component -->

<link rel="stylesheet" href="@routes.Assets.at("stylesheets/chat.css")">

<div class="container chat-component" ng-cloak>

    <span id="search-form">

            <!-- Talkback -->
        <div class="row search-row" ng-show="$ctrl.state.autoUpdate">
            <div class="col s1 push-s2">
            </div>
            <div class="input-field col s5 push-s2" id="chat-search-field">
                <input id="talkback-field" type="text" ng-model="$ctrl.talkbackTxt" ng-enter="$ctrl.talkback()">
                <label for="talkback-field">Say</label>
            </div>
        </div>

            <!-- User-Id/Querystring -->
        <div class="row search-row" ng-show="!$ctrl.state.autoUpdate">
            <div class="col s1 push-s1">
                <mac-spinner ng-show="$ctrl.updating" mac-spinner-color="white" class="update-spinner" disable-animation/>
            </div>
            <div class="input-field col s5 push-s1" id="chat-search-field">
                <input id="chatlog-search" type="text" required="required" ng-model="$ctrl.state.queryString" mac-pause-typing="$ctrl.cleanUpdate()" >
                <label for="chatlog-search">Search Text</label>
            </div>
            <div class="input-field col s3 push-s1" id="chat-search-field">
                <input id="chatlog-user-id-search" type="number" ng-model="$ctrl.state.userId" ng-change="$ctrl.cleanUpdate()">
                <label for="chatlog-user-id-search" id="chatlog-user-id-search-label">User Id</label>
            </div>
        </div>

            <!-- Include Radio / Auto Update-->
        <div class="row search-row">
            <div class=" col s4 push-s2">
                <input type="checkbox" id="radioCheckBox" class="filled-in red" ng-model="$ctrl.state.radio" ng-change="$ctrl.cleanUpdate()">
                <label for="radioCheckBox" >Radio</label>
            </div>
            <div class="col s4 push-s3">
                <input type="checkbox" id="autoUpdateCheckBox" class="filled-in" ng-model="$ctrl.state.autoUpdate" ng-change="$ctrl.cleanUpdate()" ng-checked="$ctrl.state.autoUpdate">
                <label for="autoUpdateCheckBox">Talkback Mode</label>
            </div>
        </div>

    </span>
        <!-- Pagnination -->
    <div class="center-align" ng-if="$ctrl.state.fromMessageId!=undefined" ng-click="$ctrl.cleanUpdate();">
        <a class="waves-effect waves-light btn btn-flat">Back to Start!</a>
    </div>

        <!-- Pagnination -->
    <div class="center-align" ng-show="!$ctrl.updating">
        <ul class="pagination">
            <li class="waves-effect btn-flat waves" ng-show="!$ctrl.state.autoUpdate && $ctrl.state.page > 0  || $ctrl.state.fromMessageId">
                <a href="" ng-click="$ctrl.prev()"><i class="material-icons white-text">chevron_left</i></a>
            </li>
            <span ng-show="$ctrl.state.page != 0 && !$ctrl.state.fromMessageId">Page {{$ctrl.state.page}}</span>
            <li class="waves-effect btn-flat waves" ng-show="!$ctrl.state.autoUpdate || $ctrl.msgs.length < $ctrl.state.count">
                <a href="" ng-click="$ctrl.next()"><i class="material-icons white-text">chevron_right</i></a>
            </li>
        </ul>
    </div>

    <div class="center-align" ng-show="!$ctrl.updating && $ctrl.msgs.length == 0">
        <div class="row">
            <div class="col s12 m5">
                <div class="card-panel">
                    There ware no messages matching your query!
                </div>
            </div>
        </div>
    </div>

        <!-- Messages -->
    <div ng:repeat="msg in $ctrl.msgs" class="repeated-message">
        <div class="row">
            <div class="card">

                <div class="card-content">
                    <span class="team-icon">
                        <i class="material-icons {{msg.userTeam}}-text">label</i>
                    </span>
                    <span class="name">
                        <a ui-sref="user({b3id:{{msg.userId}}})">{{msg.userName | urtstring}}</a>
                    </span>
                    <span class="txt">{{msg.txt | urtstring}}</span>
                </div>

                <div class="card-action">
                    sent to {{msg.scope}}
                    <span ng-if="msg.targetId!=undefined">
                        <a ui-sref="user({b3id:{{msg.targetId}}})">{{msg.targetName | urtstring}}</a>
                    </span>

                    <span>
                        <span ng-show="!$ctrl.state.updating && ($ctrl.state.userId || $ctrl.state.queryString)" class="time-stamp" mac-tooltip="Jump to Conversation" mac-tooltip-direction="top">
                            <a ng-if="$ctrl.state.userId || $ctrl.state.queryString" class="show-conv-link" ng-click="$ctrl.showConv(msg.id)"><i class="tiny material-icons">redo</i></a>
                        </span>
                            &nbsp;&nbsp; <online-actions b3id="msg.userId" name="{{msg.userName}}" size="tiny"></online-actions>
                        <span ng-if="$ctrl.state.updating && !($ctrl.state.userId || $ctrl.state.queryString)" class="time-stamp" mac-tooltip="Jump to Conversation" mac-tooltip-direction="top">
                                #{{msg.id}}
                        </span>
                    </span>
                    <span class="right">
                        <span ng-show="$ctrl.state.autoUpdate" mac-tooltip="{{msg.timeStamp | date:'medium'}}" mac-tooltip-direction="top">{{msg.timeStamp/1000 | timestamp}}</span>
                        <span ng-show="!$ctrl.state.autoUpdate" mac-tooltip="{{msg.timeStamp/1000 | timestamp}}" mac-tooltip-direction="top">{{msg.timeStamp | date:'dd. MM. yyyy HH:mm:ss'}}</span>
                    </span>
                </div>

            </div>
        </div>
    </div>
</div>