<!-- Angular based UtAdmin Chat Module -->

<script src="@routes.Assets.at("javascripts/chat.js")"></script>

<link rel="stylesheet" href="@routes.Assets.at("stylesheets/chat.css")">

<div class="container chat-app module" id="chat-module" ng-module="ChatModule" ng-controller="ChatModuleCtrl">
    <script>
            ChatModule.value("initialState",
                    {
                        autoUpdate: true,
                        count: 30,
                        page: 0,
                        latestId: 0,
                        radio: false,
                        userId: undefined
                    });
    </script>

    <span id="search-form">
        <div class="row search-row">
            <span us-spinner="{radius:7, width:1, length:1, position:'relative',color:'white'}" spinner-on="updating"></span>
        </div>
            <!-- Talkback -->
        <div class="row search-row" ng-show="state.autoUpdate">
            <div class="input-field col s5 push-s3" id="chat-search-field">
                <input id="talkback-field" type="text" ng-model="talkbackTxt" ng-enter="talkback()">
                <label for="talkback-field">Say</label>
            </div>
        </div>

            <!-- User-Id/Querystring -->
        <div class="row search-row" ng-show="!state.autoUpdate">
            <div class="input-field col s5 push-s2" id="chat-search-field">
                <input id="chatlog-search" type="text" required="required" ng-model="state.queryString" ng-change="update();">
                <label for="chatlog-search">Search Text</label>
            </div>
            <div class="input-field col s3 push-s2" id="chat-search-field">
                <input id="chatlog-user-id-search" type="number" ng-model="state.userId" ng-change="update()">
                <label for="chatlog-user-id-search">User Id</label>
            </div>
        </div>

            <!-- Include Radio / Auto Update-->
        <div class="row search-row">
            <div class=" col s4 push-s2">
                <input type="checkbox" id="radioCheckBox" class="filled-in red" ng-model="state.radio" ng-change="update()">
                <label for="radioCheckBox" >Radio</label>
            </div>
            <div class="col s4 push-s3">
                <input type="checkbox" id="autoUpdateCheckBox" class="filled-in" ng-model="state.autoUpdate" ng-change="update()" ng-checked="state.autoUpdate">
                <label for="autoUpdateCheckBox">Talkback Mode</label>
            </div>
        </div>

    </span>
        <!-- Pagnination -->
    <div class="center-align" ng-if="state.fromMessageId!=undefined" ng-click="state.fromMessageId=undefined;update();">
        <a class="waves-effect waves-light btn">Back to Start!</a>
    </div>

        <!-- Pagnination -->
    <div class="center-align">
        <ul class="pagination">
            <li class="waves-effect btn-flat waves" ng-show="msgs.length>0">
                <a href="" ng-click="prev();"><i class="material-icons white-text">chevron_left</i></a>
            </li>
            <li class="waves-effect btn-flat waves" ng-show="msgs.length==30">
                <a href="" ng-click="next()"><i class="material-icons white-text">chevron_right</i></a>
            </li>
        </ul>
    </div>

        <!-- Messages -->
    <div ng:repeat="msg in msgs" class="repeated-message">
        <div class="row">
            <div class="card">

                <div class="card-content">
                    <span class="team-icon">
                        <i class="material-icons {{msg.userTeam}}-text">label</i>
                    </span>
                    <span class="name">
                        <a href="/user?id={{msg.userId}}" target="_blank">{{msg.userName}}</a>
                    </span>
                    <span class="txt">{{msg.txt}}</span>
                </div>

                <div class="card-action">
                    sent to {{msg.scope}}
                    <span ng-if="msg.targetId!=undefined">
                        <a href="/user?id={{msg.targetId}}" target="_blank">{{msg.targetName}}</a>
                    </span>

                    <span class="time-stamp">{{msg.timeStamp | timeAgo}}</span>
                    <span class="right">
                        #{{msg.id}} <a ng-if="state.userId!=undefined || state.queryString != ''" ng-click="state.fromMessageId=msg.id;update();">Show Conversation</a>
                    </span>
                </div>

            </div>
        </div>
    </div>

        <!-- Pagnination -->
    <div class="center-align">
        <ul class="pagination">
            <li class="waves-effect btn-flat waves" ng-show="msgs.length>0">
                <a href="" ng-click="prev();"><i class="material-icons white-text">chevron_left</i></a>
            </li>
            <li class="waves-effect btn-flat waves" ng-show="msgs.length==30">
                <a href="" ng-click="next()"><i class="material-icons white-text">chevron_right</i></a>
            </li>
        </ul>
    </div>
</div>